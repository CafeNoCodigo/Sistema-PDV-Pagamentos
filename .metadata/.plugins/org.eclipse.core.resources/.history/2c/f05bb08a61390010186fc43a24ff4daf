package com.minhaloja.sistema_pagamento.controller;

import com.minhaloja.sistema_pagamento.dao.FuncionarioDAO;
import com.minhaloja.sistema_pagamento.dao.ProdutoDAO;
import com.minhaloja.sistema_pagamento.model.Funcionario;

import javafx.fxml.FXML;
import javafx.scene.control.Alert;
import javafx.scene.control.Button;
import javafx.scene.control.DatePicker;
import javafx.scene.control.TextField;

public class telaCadastroFuncionarioController {
	
	@FXML private TextField tfCodigo;
	@FXML private TextField tfNome;
	@FXML private TextField tfNumeroBi;
	@FXML private TextField tfTelefone1;
	@FXML private TextField tfTelefone2;
	@FXML private TextField tfEndereco;
	@FXML private TextField tfBairro;
	@FXML private TextField tfCidade;
	@FXML private TextField tfNuit;
	@FXML private TextField tfCargo;
	@FXML private TextField tfContaBancaria1;
	@FXML private TextField tfContaBancaria2;
	@FXML private TextField tfSalario;
	@FXML private TextField tfTransporte;
	@FXML private TextField tfAlimentacao;
	@FXML private TextField tfLoja;
	
	@FXML private Button btnSalvar;
	
	@FXML private DatePicker dpDataNascido;
	@FXML private DatePicker dpDataInicio;
	@FXML private DatePicker dpDataFim;

	private final FuncionarioDAO funcionarioDAO = new FuncionarioDAO();
	
	@FXML
	public void salvarFuncionario() {
	    Funcionario funcionario = new Funcionario();

	    try {
	        funcionario.setNome(tfNome.getText());
	        funcionario.setNumeroBi(tfNumeroBi.getText());
	        funcionario.setTelefone1(Double.parseDouble(tfTelefone1.getText()));
	        funcionario.setTelefone2(Double.parseDouble(tfTelefone2.getText()));
	        funcionario.setEndereco(tfEndereco.getText());
	        funcionario.setBairro(tfBairro.getText());
	        funcionario.setCidade(tfCidade.getText());
	        funcionario.setSalario(Integer.parseInt(tfSalario.getText()));
	        funcionario.setTransporte(Integer.parseInt(tfTransporte.getText()));
	        funcionario.setAlimentacao(Integer.parseInt(tfAlimentacao.getText()));
	        funcionario.setNuit(tfNuit.getText());
	        funcionario.setCargo(tfCargo.getText());
	        funcionario.setContaBancaria1(tfContaBancaria1.getText());
	        funcionario.setContaBancaria2(tfContaBancaria2.getText());
	        funcionario.setLoja(tfLoja.getText());

	        // Campos opcionais: datas
	        if (dpDataNascido.getValue() != null) {
	            funcionario.setDataNascido(dpDataNascido.getValue());
	        }
	        if (dpDataInicio.getValue() != null) {
	            funcionario.setDataInicio(dpDataInicio.getValue());
	        }
	        if (dpDataFim.getValue() != null) {
	            funcionario.setDataFim(dpDataFim.getValue());
	        }

	        // Imagens
	        funcionario.setImagemFuncionario(imagemFuncionarioBytes); // deve ser um byte[] já carregado
	        funcionario.setImagemBi(imagemBiBytes); // idem

	        // Código (opcional)
	        if (!tfCodigo.getText().isEmpty()) {
	            funcionario.setCodigo(Double.parseDouble(tfCodigo.getText()));
	        }

	        // Salvar no banco
	        FuncionarioDAO dao = new FuncionarioDAO();
	        dao.salvarFuncionario(funcionario);

	    } catch (NumberFormatException e) {
	        Alert alerta = new Alert(Alert.AlertType.ERROR);
	        alerta.setTitle("Erro");
	        alerta.setHeaderText("Erro de Formato");
	        alerta.setContentText("Preencha corretamente os campos numéricos (telefone, salário etc).");
	        alerta.showAndWait();
	    }
	}


}
